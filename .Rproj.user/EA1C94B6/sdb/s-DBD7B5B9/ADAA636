{
    "collab_server" : "",
    "contents" : "library(stats)\n#library(kernlab)\n\n\ndata_in<-read.csv(\"E:/我的坚果云/Workbackup/新能源汽车项目/data/250_predict.csv\",header=T, sep=\",\")\ndata_pre<-read.csv(\"E:/我的坚果云/Workbackup/新能源汽车项目/data/0.5c充0.625c放电(250mah).csv\",\n                  header=T,encoding=\"UTF-8\",sep=\",\")\ndata_soh<-read.csv(\"E:/我的坚果云/Workbackup/新能源汽车项目/data/0.5C充0.625C放电(250mAh)_2.csv\",header=T, sep=\",\")\n\n\n#数据处理\n\ndata_soh[,5]<-data_soh[,4]/250\n\nn<-dim(data_in)[1]\nfor(j in 1:n)\n{\n  #data_in[j,1]<-data_in[j,1]%%200\n  #if(data_in[j,1]==0) data_in[j,1]<-200\n  data_in[j,3]<-(j-1)%/%200+1\n}\n\n#划分训练集与测试集\nset.seed(1)\nind<-sample(2,798,replace = T, prob=c(0.7,0.3))\nindex<-rep(1,798*200)\nfor(i in 1:length(index))\n{\n   index[i]<-ind[(i-1)%/%200+1]\n}\n\n#devide training set and test set\ntrainset<-data_in[index==1,]\ntestset<-data_in[index==2,]\n\n#set.seed(1)\n#newi<-sample(1:100,1)\n#set.seed(1)\n#newn<-sample(1:239,1)\n\n#esti<-testset[(200*newn+newi):((200*newn+newi)+99),]\n\n\n#定义距离函数（测试样本曲线段与训练集中各曲线的距离）\n#distance<-matrix(rep(0,560*3),nrow=560)\n#for(i in 1:558)\n#{\n#  distance[i,1]<-i\n#}\n\n#for(i in 0:558)\n#{\n  #训练集中每一条曲线，分别计算距离\n#  x<-trainset[(i*200+1):(i*200+200),1]\n#  y<-trainset[(i*200+1):(i*200+200),4]\n#  xyspline<-smooth.spline(x,y,cv=T) #样条插值求曲线\n#  sum<-10000\n#  for(j in 0:(200-length(esti[,4])))\n#  {\n#    sum_temp<-0\n#    for(k in 1:length(esti[,4]))\n#    {\n#      sum_temp<-sum_temp+(predict(xyspline,j+k)$y-esti[k,4])^2\n#    }\n#    if(sum_temp<sum) sum<-sum_temp\n#  }\n#  distance[i+1,2]<-sum\n#  distance[i+1,3]<-trainset[(i*200+1),3]\n#}\n\n\n#distance_new<-distance[order(distance[,2]),]\n\n\n\n#data_pre[213,3]\n\n#newindex<-distance_new[2:10,3]\n\n#data_esti<-mean(data_pre[newindex,3])\n\n#考察估计值与真实值误差\nerror<-matrix(rep(0,239*5),nrow = 239)\n\n\n\n\ntimestart<-Sys.time()\nfor(l in 150:165) #239\n{\n  #timestart_0<-Sys.time()\n  newi<-sample(1:50,1)\n  esti<-testset[(200*l+newi):((200*l+newi)+49),] #随机产生长度为50的曲线段\n  error[l,1]<-testset[200*l+1,3] #记录该循环次数，实际运用中应为未知\n  distance<-matrix(rep(0,559*3),nrow=559)\n  for(i in 1:559)\n  {\n    distance[i,1]<-i\n  }\n  \n  for(i in 0:558)\n  {\n    x<-trainset[(1:200),1]\n    y<-trainset[(i*200+1):(i*200+200),4]\n    xyspline<-smooth.spline(x,y,cv=T)\n    sum<-10000\n    for(j in 0:(199-length(esti[,4])))\n    {\n      sum_temp<-0\n      for(k in 1:length(esti[,4]))\n      {\n        sum_temp<-sum_temp+(predict(xyspline,j+k)$y-esti[k,4])^2\n      }\n      if(sum_temp<sum) sum<-sum_temp\n    }\n    distance[i+1,2]<-sum\n    distance[i+1,3]<-trainset[(i*200+1),3]\n  }\n  distance_new<-distance[order(distance[,2]),]\n  newindex<-distance_new[2:11,3] #距离最近的10个数据的平均值作为估计值\n  data_esti<-mean(data_soh[newindex,5])\n  error[l,2]<-data_esti #估算SOH  \n  error[l,3]<-data_soh[error[l,1],5] #实际SOH\n  error[l,4]<-error[l,2]-error[l,3] #估算误差\n  error[l,5]<-newi  #所用曲线段位置\n  #timeend_0<-Sys.time()\n  #runningtime<-timeend-timestart\n}\ntimeend<-Sys.time()\nrunningtime<-timeend-timestart\n\n\nwrite.csv(error,\"C:/Users/1/Documents/error_2.csv\")\n\n\n",
    "created" : 1502158829907.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2990922475",
    "id" : "ADAA636",
    "lastKnownWriteTime" : 1502098554,
    "last_content_update" : 1502098554,
    "path" : "E:/我的坚果云/Workbackup/新能源汽车项目/R_files/battery_gpr.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}